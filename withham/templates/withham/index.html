<<<<<<< HEAD
{# withham/templates/withham/index.html #}

{% extends "withham/base.html" %} {# 新しいbase.htmlを継承 #}
{% load static %} {# staticタグを使う場合 #}

{% block title %}タイムライン - withham{% endblock %} {# ページのタイトルを設定 #}

{% block content %} {# base.htmlのcontentブロックをこの内容で上書き #}
    <h2 class="mb-4">{{ message|default:"タイムライン" }}</h2> {# ビューから渡されたmessage、なければデフォルト表示 #}
    {# <hr> #} {# Bootstrapのカードで区切られるのでhrは不要かも #}

    {# ↓↓↓ ここから投稿一覧表示 (Bootstrap Card形式) ↓↓↓ #}
    {% for post in posts %} {# ビューから渡された 'posts' リストをループ #}
        <div class="card mb-3 shadow-sm"> {# カード全体を囲む (マージンと影付き) #}
            <div class="card-body"> {# カードのコンテンツ部分 #}
                <div class="d-flex justify-content-between align-items-center mb-2">
                    {# カードのヘッダー部分 (左: ユーザー名+ハムスター / 右: 日時) #}
                    <div class="lh-sm"> {# 行の高さを調整 #}
                        <h5 class="card-title mb-0">
                            {# 投稿者のプロフィールへのリンク #}
                            <a href="{% url 'withham:profile_detail' post.author.pk %}" class="text-decoration-none fw-bold">@{{ post.author.username }}</a>
                        </h5>
                        {# ハムスターが関連付けられていればバッジで表示 #}
                        {% if post.hamster %}
                             <span class="badge bg-info fw-normal">🐹 {{ post.hamster.name }}</span>
                        {% endif %}
                    </div>
                    {# 投稿日時を小さく表示 #}
                    <small class="text-muted flex-shrink-0 ms-2">{{ post.created_at|date:"y/m/d H:i" }}</small> {# 短縮表示例 #}
                </div>

                {# 投稿本文 (改行を<br>に変換) #}
                <p class="card-text mt-2 mb-2">{{ post.text|linebreaksbr }}</p>

                {# 投稿画像があれば表示 (レスポンシブ対応) #}
                {% if post.image %}
                    {# 画像クリックで詳細ページへ飛ぶようにリンクを追加（任意） #}
                    {# <a href="#"> #}
                        <img src="{{ post.image.url }}" class="img-fluid rounded mb-2" alt="投稿画像 {{ post.id }}">
                    {# </a> #}
                {% endif %}

                {# アクションボタンなどのエリア #}
                <div class="d-flex justify-content-start">
                    <button type="button" class="btn btn-outline-secondary btn-sm me-2">
                        <i class="bi bi-chat"></i> コメント {# Bootstrap Iconsを使う場合の例 #}
                    </button>
                    <button type="button" class="btn btn-outline-danger btn-sm me-2">
                        <i class="bi bi-heart"></i> いいね {# Bootstrap Iconsを使う場合の例 #}
                    </button>
                    {# 他のアクション（例：リポスト、共有など） #}
                    {# <button type="button" class="btn btn-outline-secondary btn-sm"><i class="bi bi-repeat"></i></button> #}
                </div>
            </div> {# card-body 終了 #}
        </div> {# card 終了 #}
    {% empty %}
        {# 投稿が1件もない場合に表示 (Bootstrap Alertを使用) #}
        <div class="alert alert-secondary mt-4" role="alert">
            まだ投稿がありません。最初の投稿をしてみませんか？
            {% if user.is_authenticated %}
                 <a href="{% url 'withham:post_create' %}" class="btn btn-primary btn-sm ms-2">新規投稿</a>
            {% endif %}
        </div>
    {% endfor %}
    {# ↑↑↑ ここまで投稿一覧表示 ↑↑↑ #}

{% endblock %} {# contentブロックの終了 #}
=======
{# withham/templates/withham/index.html (いいね機能・モーダル対応) #}

{% extends "withham/base.html" %} {# Tailwind適用済みのbase.htmlを継承 #}
{% load static %}
{% load humanize %}

{% block title %}タイムライン - withham{% endblock %}

{% block content %}
    {# 見出しは削除済み #}
    {# <h2 class="text-2xl font-bold text-[#1c140d] mb-6">{{ message|default:"タイムライン" }}</h2> #}

    {# --- 投稿一覧ループ --- #}
    {% for post in posts %}
        <div class="bg-white rounded-xl shadow-sm mb-4 border border-gray-200">
            <div class="p-4"> {# 内側のパディング #}
                {# --- 投稿ヘッダー --- #}
                <div class="flex justify-between items-center mb-3">
                   <div class="flex items-center gap-3">
                        {# プロフィールアイコン #}
                        <a href="{% url 'withham:profile_detail' post.author.pk %}">
                            {% if post.author.profile.avatar %}
                            <img src="{{ post.author.profile.avatar.url }}" class="h-12 w-12 rounded-full object-cover" alt="{{ post.author.username }}">
                            {% else %}
                            <img src="{% static 'images/default_avatar.png' %}" class="h-12 w-12 rounded-full bg-gray-200 object-cover" alt="デフォルトアバター">
                            {% endif %}
                        </a>
                        <div>
                            {# 投稿者名とハムスター名 #}
                            <a href="{% url 'withham:profile_detail' post.author.pk %}" class="text-[#1c140d] text-base font-medium leading-normal hover:underline">@{{ post.author.username }}</a>
                            {% if post.hamster %}
                                 <span class="ml-2 inline-block bg-[#e0f2fe] text-[#0ea5e9] text-xs font-medium px-2 py-0.5 rounded-full">🐹 {{ post.hamster.name }}</span>
                            {% endif %}
                            {# 投稿日時 #}
                            <p class="text-[#9c7349] text-sm font-normal leading-normal">{{ post.created_at|timesince }}前</p>
                        </div>
                    </div>
                     {# オプションメニュー (...) ボタンなど（任意）#}
                     <button class="ml-auto text-gray-500 hover:text-gray-700">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor" viewBox="0 0 256 256"><path d="M144,128a16,16,0,1,1-16-16A16,16,0,0,1,144,128ZM128,64a16,16,0,1,0-16-16A16,16,0,0,0,128,64Zm0,128a16,16,0,1,0,16,16A16,16,0,0,0,128,192Z"></path></svg>
                     </button>
                </div>

                {# --- 投稿本文と画像 (詳細ページへのリンク) --- #}
                <a href="{% url 'withham:post_detail' post.pk %}" class="block text-inherit hover:opacity-90">
                    {# 投稿本文 #}
                    {% if post.text %}
                        <p class="text-[#1c140d] text-base leading-relaxed my-3">{{ post.text|linebreaksbr }}</p>
                    {% endif %}
                </a>
                {# --- 投稿画像 (モーダル表示トリガー付き) --- #}
                {% if post.image %}
                    {# 画像コンテナにトリガークラスとデータ属性を追加 #}
                    <div class="my-3 cursor-pointer open-modal-trigger" {# マージン、カーソル、トリガークラス #}
                         data-full-src="{{ post.image.url }}"> {# ★ データ属性を追加 #}
                         {# 画像を囲むdivに縦横比を指定 #}
                        <div class="aspect-video w-full overflow-hidden rounded-lg bg-gray-100"> {# aspect-video (16:9) を指定 #}
                            <img src="{{ post.image.url }}"
                                 class="w-full h-full object-cover" {# コンテナに合わせて object-cover を指定 #}
                                 alt="投稿画像 {{ post.id }}">
                        </div>
                    </div>
                {% endif %}


                {# --- アクションボタン --- #}
                <div class="flex items-center gap-4 text-[#9c7349] pt-3 border-t border-gray-100"> {# 上境界線とパディングを追加 #}
                    {# コメントボタン (詳細ページのコメントフォームへ) #}
                     <a href="{% url 'withham:post_detail' post.pk %}#comment-form" class="flex items-center gap-1 hover:text-[#1c140d]"> {# ← 詳細ページのコメントフォームへ直接飛ぶリンク #}
                        <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor" viewBox="0 0 256 256"><path d="M128,24A104,104,0,0,0,36.18,176.88L24.83,210.93a16,16,0,0,0,20.24,20.24l34.05-11.35A104,104,0,1,0,128,24Zm0,192a87.87,87.87,0,0,1-44.06-11.81,8,8,0,0,0-6.54-.67L40,216,52.47,178.6a8,8,0,0,0-.66-6.54A88,88,0,1,1,128,216Z"></path></svg>
                        <span class="text-xs font-medium">{{ post.comments.count }}</span> {# コメント数を表示 (モデルに related_name='comments' が必要) #}
                    </a>

                    {# いいねボタン #}
                    {% if user.is_authenticated %}
                    <button type="button"
                            class="like-button flex items-center gap-1 {% if user in post.likes.all %}text-[#f2800d]{% else %}text-[#9c7349] hover:text-[#f2800d]{% endif %}"
                            data-post-id="{{ post.pk }}"
                            data-like-url="{% url 'withham:toggle_like' post.pk %}">
                        <svg class="like-icon" xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor" viewBox="0 0 256 256">
                            {% if user in post.likes.all %}
                                <path d="M128,216S24,160,24,94A54,54,0,0,1,78,40c22.59,0,41.94,12.31,50,32,8.06-19.69,27.41-32,50-32a54,54,0,0,1,54,54C232,160,128,216,128,216Z"></path>
                            {% else %}
                                <path d="M178,32c-20.65,0-38.73,8.88-50,23.89C116.73,40.88,98.65,32,78,32A62.07,62.07,0,0,0,16,94c0,70,103.79,126.66,108.21,129a8,8,0,0,0,7.58,0C136.21,220.66,240,164,240,94A62.07,62.07,0,0,0,178,32ZM128,206.8C109.74,196.16,32,147.69,32,94A46.06,46.06,0,0,1,78,48c19.45,0,35.78,10.36,42.6,27a8,8,0,0,0,14.8,0c6.82-16.67,23.15-27,42.6-27a46.06,46.06,0,0,1,46,46C224,147.61,146.24,196.15,128,206.8Z"></path>
                            {% endif %}
                        </svg>
                        <span class="like-count text-xs font-medium">{{ post.likes.count }}</span>
                    </button>
                    {% else %}
                        <span class="flex items-center gap-1 text-[#9c7349]">
                             <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor" viewBox="0 0 256 256"><path d="M178,32c-20.65,0-38.73,8.88-50,23.89C116.73,40.88,98.65,32,78,32A62.07,62.07,0,0,0,16,94c0,70,103.79,126.66,108.21,129a8,8,0,0,0,7.58,0C136.21,220.66,240,164,240,94A62.07,62.07,0,0,0,178,32ZM128,206.8C109.74,196.16,32,147.69,32,94A46.06,46.06,0,0,1,78,48c19.45,0,35.78,10.36,42.6,27a8,8,0,0,0,14.8,0c6.82-16.67,23.15-27,42.6-27a46.06,46.06,0,0,1,46,46C224,147.61,146.24,196.15,128,206.8Z"></path></svg>
                            <span class="like-count text-xs font-medium">{{ post.likes.count }}</span>
                        </span>
                    {% endif %}

                    {# シェアボタン #}
                    <button type="button" class="flex items-center gap-1 hover:text-[#1c140d]">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor" viewBox="0 0 256 256"><path d="M227.32,28.68a16,16,0,0,0-15.66-4.08l-.15,0L19.57,82.84a16,16,0,0,0-2.42,29.84l85.62,40.55,40.55,85.62A15.86,15.86,0,0,0,157.74,248q.69,0,1.38-.06a15.88,15.88,0,0,0,14-11.51l58.2-191.94c0-.05,0-.1,0-.15A16,16,0,0,0,227.32,28.68ZM157.83,231.85l-.05.14L118.42,148.9l47.24-47.25a8,8,0,0,0-11.31-11.31L107.1,137.58,24,98.22l.14,0L216,40Z"></path></svg>
                        <span class="text-xs font-medium">シェア</span>
                    </button>
                     {# ブックマークボタン #}
                    <button type="button" class="ml-auto hover:text-[#1c140d]">
                         <svg xmlns="http://www.w3.org/2000/svg" width="22px" height="22px" fill="currentColor" viewBox="0 0 256 256"><path d="M184,32H72A16,16,0,0,0,56,48V224a8,8,0,0,0,12.24,6.78L128,193.43l59.76,37.35A8,8,0,0,0,200,224V48A16,16,0,0,0,184,32Zm0,177.57l-51.76-32.35a8,8,0,0,0-8.48,0L72,209.57V48H184Z"></path></svg>
                    </button>
                </div>
            </div>
        </div>
    {% empty %}
        <div class="bg-yellow-50 border border-yellow-200 text-yellow-800 px-4 py-3 rounded-lg relative" role="alert">
            <strong class="font-bold">お知らせ:</strong>
            <span class="block sm:inline">まだ投稿がありません。最初の投稿をしてみませんか？</span>
            {% if user.is_authenticated %}
                 <a href="{% url 'withham:post_create' %}" class="inline-block bg-[#f2800d] hover:opacity-90 text-[#1c140d] font-bold py-1 px-3 rounded-full text-sm ml-2">新規投稿</a>
            {% endif %}
        </div>
    {% endfor %}
    {# --- 投稿一覧ループ終了 --- #}

{% endblock %}
>>>>>>> b6e6bb3 (no message)
