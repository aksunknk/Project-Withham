<<<<<<< HEAD
{# withham/templates/withham/base.html (最新版 - Tailwind CSS, モーダル, いいねJS) #}
=======
{# withham/templates/withham/base.html (モーダル・いいねJS追加版) #}
>>>>>>> ddb4b7b7eafd9da8db9f8206bcdeba3747b626b2
{% load static %}
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<<<<<<< HEAD
    <title>{% block title %}withham{% endblock %}</title>
=======
    <title>{% block title %}withham{% endblock title %}</title>
>>>>>>> ddb4b7b7eafd9da8db9f8206bcdeba3747b626b2

    {# Google Fonts 読み込み #}
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
    <link
      rel="stylesheet"
      as="style"
      onload="this.rel='stylesheet'"
      href="https://fonts.googleapis.com/css2?display=swap&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900&amp;family=Plus+Jakarta+Sans%3Awght%40400%3B500%3B700%3B800"
    />

    {# Tailwind CSS CDN スクリプト #}
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>

    {# 各ページで追加の<head>要素を挿入するためのブロック #}
    {% block extra_head %}{% endblock %}
</head>
<body>
    {# 全体を囲むコンテナ #}
    <div class="relative flex size-full min-h-screen flex-col bg-[#f4ede7] group/design-root overflow-x-hidden" style='font-family: "Plus Jakarta Sans", "Noto Sans", sans-serif;'>
        <div class="layout-container flex h-full grow flex-col">
            {# メインレイアウト (サイドバーとコンテンツ) #}
            <div class="gap-1 px-6 flex flex-1 justify-center py-5">

                {# --- 左サイドバー --- #}
                <div class="layout-content-container flex flex-col w-80 flex-shrink-0"> {# 幅固定、縮まないように #}
                    <div class="flex h-full min-h-[700px] flex-col justify-between bg-[#fcfaf8] p-4 rounded-xl shadow-sm border border-gray-200"> {# 背景色、パディング、角丸、影、枠線を追加 #}
                        <div class="flex flex-col gap-4">
                            {# サイトロゴやタイトル (任意) #}
                            <div class="p-3 text-center">
                                <a href="{% url 'withham:index' %}" class="text-2xl font-bold text-[#1c140d] hover:text-[#f2800d]">withham</a>
                            </div>
                            {# ナビゲーションリンク #}
                            <div class="flex flex-col gap-1"> {# gap-1に変更して少し詰める #}
                                {# --- Home Link --- #}
                                <a href="{% url 'withham:index' %}" class="flex items-center gap-3 px-2 py-1 rounded-full hover:bg-[#f4ede7] text-[#1c140d]"> {# パディング変更、文字色指定 #}
                                    <div class="flex-shrink-0" data-icon="House" data-size="24px" data-weight="fill">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256"><path d="M224,115.55V208a16,16,0,0,1-16,16H168a16,16,0,0,1-16-16V168a8,8,0,0,0-8-8H112a8,8,0,0,0-8,8v40a16,16,0,0,1-16,16H48a16,16,0,0,1-16-16V115.55a16,16,0,0,1,5.17-11.78l80-75.48.11-.11a16,16,0,0,1,21.53,0,1.14,1.14,0,0,0,.11.11l80,75.48A16,16,0,0,1,224,115.55Z"></path></svg>
                                    </div>
                                    <p class="text-sm font-medium leading-normal">Home</p>
                                </a>
                                {# --- Explore Link --- #}
                                <a href="#" class="flex items-center gap-3 px-2 py-1 rounded-full hover:bg-[#f4ede7] text-[#1c140d]"> {# パディング変更、文字色指定 #}
                                    <div class="flex-shrink-0" data-icon="Compass" data-size="24px" data-weight="regular">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256"><path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216ZM172.42,72.84l-64,32a8.05,8.05,0,0,0-3.58,3.58l-32,64A8,8,0,0,0,80,184a8.1,8.1,0,0,0,3.58-.84l64-32a8.05,8.05,0,0,0,3.58-3.58l32-64a8,8,0,0,0-10.74-10.74ZM138,138,97.89,158.11,118,118l40.15-20.07Z"></path></svg>
                                    </div>
                                    <p class="text-[#1c140d] text-sm font-medium leading-normal">Explore</p>
                                </a>
                                {# --- Create Link --- #}
                                {% if user.is_authenticated %}
                                <a href="{% url 'withham:post_create' %}" class="flex items-center gap-3 px-2 py-1 rounded-full hover:bg-[#f4ede7] text-[#1c140d]"> {# パディング変更、文字色指定 #}
                                    <div class="flex-shrink-0" data-icon="Plus" data-size="24px" data-weight="regular">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256"><path d="M224,128a8,8,0,0,1-8,8H136v80a8,8,0,0,1-16,0V136H40a8,8,0,0,1,0-16h80V40a8,8,0,0,1,16,0v80h80A8,8,0,0,1,224,128Z"></path></svg>
                                    </div>
                                    <p class="text-[#1c140d] text-sm font-medium leading-normal">Create</p>
                                </a>
                                {% endif %}
                                {# --- Chat Link --- #}
                                <a href="#" class="flex items-center gap-3 px-2 py-1 rounded-full hover:bg-[#f4ede7] text-[#1c140d]"> {# パディング変更、文字色指定 #}
                                    <div class="flex-shrink-0" data-icon="ChatCircleDots" data-size="24px" data-weight="regular">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256"><path d="M140,128a12,12,0,1,1-12-12A12,12,0,0,1,140,128ZM84,116a12,12,0,1,0,12,12A12,12,0,0,0,84,116Zm88,0a12,12,0,1,0,12,12A12,12,0,0,0,172,116Zm60,12A104,104,0,0,1,79.12,219.82L45.07,231.17a16,16,0,0,1-20.24-20.24l11.35-34.05A104,104,0,1,1,232,128Zm-16,0A88,88,0,1,0,51.81,172.06a8,8,0,0,1,.66,6.54L40,216,77.4,203.53a7.85,7.85,0,0,1,2.53-.42,8,8,0,0,1,4,1.08A88,88,0,0,0,216,128Z"></path></svg>
                                    </div>
                                    <p class="text-[#1c140d] text-sm font-medium leading-normal">Chat</p>
                                </a>
                                {# --- Notifications Link --- #}
                                <a href="#" class="flex items-center gap-3 px-2 py-1 rounded-full hover:bg-[#f4ede7] text-[#1c140d]"> {# パディング変更、文字色指定 #}
                                    <div class="flex-shrink-0" data-icon="Bell" data-size="24px" data-weight="regular">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256"><path d="M221.8,175.94C216.25,166.38,208,139.33,208,104a80,80,0,1,0-160,0c0,35.34-8.26,62.38-13.81,71.94A16,16,0,0,0,48,200H88.81a40,40,0,0,0,78.38,0H208a16,16,0,0,0,13.8-24.06ZM128,216a24,24,0,0,1-22.62-16h45.24A24,24,0,0,1,128,216ZM48,184c7.7-13.24,16-43.92,16-80a64,64,0,1,1,128,0c0,36.05,8.28,66.73,16,80Z"></path></svg>
                                    </div>
                                    <p class="text-[#1c140d] text-sm font-medium leading-normal">Notifications</p>
                                </a>
                                {# --- Profile Link --- #}
                                <a href="{% if user.is_authenticated %}{% url 'withham:profile_detail' user.pk %}{% else %}{% url 'withham:login' %}{% endif %}" class="flex items-center gap-3 px-2 py-1 rounded-full hover:bg-[#f4ede7] text-[#1c140d]"> {# パディング変更、文字色指定 #}
                                    <div class="flex-shrink-0" data-icon="User" data-size="24px" data-weight="regular">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256"><path d="M230.92,212c-15.23-26.33-38.7-45.21-66.09-54.16a72,72,0,1,0-73.66,0C63.78,166.78,40.31,185.66,25.08,212a8,8,0,1,0,13.85,8c18.84-32.56,52.14-52,89.07-52s70.23,19.44,89.07,52a8,8,0,1,0,13.85-8ZM72,96a56,56,0,1,1,56,56A56.06,56.06,0,0,1,72,96Z"></path></svg>
                                    </div>
                                    <p class="text-[#1c140d] text-sm font-medium leading-normal">Profile</p>
                                </a>
                                {# --- Logout Link --- #}
                                {% if user.is_authenticated %}
                                <a href="{% url 'withham:logout' %}" class="flex items-center gap-3 px-2 py-1 rounded-full hover:bg-[#f4ede7] text-[#1c140d]"> {# パディング変更、文字色指定 #}
                                     <div class="flex-shrink-0" data-icon="SignOut" data-size="24px" data-weight="regular">
                                         <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256"><path d="M112,216a8,8,0,0,1-8,8H48a16,16,0,0,1-16-16V48A16,16,0,0,1,48,32h56a8,8,0,0,1,0,16H48V208h56A8,8,0,0,1,112,216Zm109.66-92.69-56-56a8,8,0,0,0-11.32,11.32L196.69,120H104a8,8,0,0,0,0,16h92.69l-42.35,42.34a8,8,0,0,0,11.32,11.32l56-56A8,8,0,0,0,221.66,123.31Z"></path></svg>
                                     </div>
                                     <p class="text-[#1c140d] text-sm font-medium leading-normal">Logout</p>
                                 </a>
                                {% endif %}
                            </div>
                        </div>
                        {# --- Sign up / Login Button --- #}
                        {% if not user.is_authenticated %}
                        <a href="{% url 'withham:login' %}"
                          class="flex mt-auto min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 px-4 bg-[#f2800d] text-[#1c140d] text-sm font-bold leading-normal tracking-[0.015em] hover:opacity-90"
                        > {# ボタンが常に下に来るように mt-auto を追加 #}
                          <span class="truncate">Login / Sign up</span>
                        </a>
                        {% endif %}
                    </div>
                </div>

                {# --- 中央コンテンツエリア --- #}
                <div class="layout-content-container flex flex-col max-w-[960px] flex-1">
                    {# 各ページのコンテンツがこのブロックに挿入される #}
                    {% block content %}
                    {% endblock %}
                </div>

            </div> {# flex flex-1 justify-center py-5 終了 #}
        </div> {# layout-container 終了 #}
    </div> {# relative flex size-full 終了 #}

    {# --- 画像拡大モーダル用のHTML --- #}
    <div id="imageModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 hidden z-50"> {# 普段は hidden で隠す #}
        <div class="relative max-w-3xl max-h-[80vh]"> {# 画像サイズに合わせて調整 #}
            <img id="modalImage" src="" alt="拡大画像" class="block max-w-full max-h-[80vh] rounded-lg shadow-lg">
            <button id="closeModalButton" class="absolute top-2 right-2 text-white bg-black bg-opacity-50 rounded-full p-1 hover:bg-opacity-75 focus:outline-none">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                </svg>
            </button>
        </div>
    </div>

    {# 各ページで追加のJavaScriptを読み込むためのブロック #}
    {% block extra_js %}{% endblock %}

    {# --- モーダル制御用 + いいね機能用 JavaScript --- #}
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- 画像モーダル処理 ---
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            const closeModalButton = document.getElementById('closeModalButton');
            const imageTriggers = document.querySelectorAll('.open-modal-trigger');

            imageTriggers.forEach(trigger => {
                trigger.addEventListener('click', (event) => {
                    event.preventDefault();
                    const fullSrc = trigger.dataset.fullSrc;
                    if (fullSrc && modal && modalImage) {
                        modalImage.setAttribute('src', fullSrc);
                        modal.classList.remove('hidden');
                    }
                });
            });

            if (closeModalButton && modal) {
                closeModalButton.addEventListener('click', () => {
                    modal.classList.add('hidden');
                    modalImage.setAttribute('src', '');
                });
            }
            if (modal) {
                modal.addEventListener('click', (event) => {
                    if (event.target === modal) {
                        modal.classList.add('hidden');
                        modalImage.setAttribute('src', '');
                    }
                });
            }
            document.addEventListener('keydown', (event) => {
                if (event.key === 'Escape' && modal && !modal.classList.contains('hidden')) {
                    modal.classList.add('hidden');
                    modalImage.setAttribute('src', '');
                }
            });

            // --- いいね機能処理 ---
            function getCookie(name) { // CSRFトークン取得用
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
            const csrftoken = getCookie('csrftoken');

            document.querySelectorAll('.like-button').forEach(button => {
                button.addEventListener('click', function() {
                    const postId = this.dataset.postId;
                    const url = this.dataset.likeUrl;
                    // ↓↓↓ like-count span をボタンの中から探すように修正 ↓↓↓
                    const likeCountSpan = this.querySelector('.like-count');
                    const likeIconSvg = this.querySelector('svg'); // svgタグを取得

                    fetch(url, {
                        method: 'POST',
                        headers: {
                            'X-CSRFToken': csrftoken,
                            'X-Requested-With': 'XMLHttpRequest',
                            'Content-Type': 'application/json'
                        },
                    })
                    .then(response => {
                        if (!response.ok) { throw new Error('Network response was not ok'); }
                        return response.json();
                    })
                    .then(data => {
                        if (likeCountSpan) {
                            likeCountSpan.textContent = data.likes_count;
                        }
                        // アイコンとボタンのスタイル更新
                        const likedColor = 'text-[#f2800d]';
                        const unlikedColor = 'text-[#9c7349]';
                        const hoverColor = 'hover:text-[#f2800d]';
                        const filledHeartPath = '<path d="M128,216S24,160,24,94A54,54,0,0,1,78,40c22.59,0,41.94,12.31,50,32,8.06-19.69,27.41-32,50-32a54,54,0,0,1,54,54C232,160,128,216,128,216Z"></path>';
                        const outlineHeartPath = '<path d="M178,32c-20.65,0-38.73,8.88-50,23.89C116.73,40.88,98.65,32,78,32A62.07,62.07,0,0,0,16,94c0,70,103.79,126.66,108.21,129a8,8,0,0,0,7.58,0C136.21,220.66,240,164,240,94A62.07,62.07,0,0,0,178,32ZM128,206.8C109.74,196.16,32,147.69,32,94A46.06,46.06,0,0,1,78,48c19.45,0,35.78,10.36,42.6,27a8,8,0,0,0,14.8,0c6.82-16.67,23.15-27,42.6-27a46.06,46.06,0,0,1,46,46C224,147.61,146.24,196.15,128,206.8Z"></path>';

                        if (data.liked) {
                            this.classList.remove(unlikedColor, hoverColor);
                            this.classList.add(likedColor);
                            if(likeIconSvg) { likeIconSvg.innerHTML = filledHeartPath; }
                        } else {
                            this.classList.remove(likedColor);
                            this.classList.add(unlikedColor, hoverColor);
                             if(likeIconSvg) { likeIconSvg.innerHTML = outlineHeartPath; }
                        }
                    })
                    .catch(error => {
                        console.error('Error toggling like:', error);
                    });
                });
            });

             // --- 画像モーダル処理 (いいねJSの後でも前でもOK) ---
             // (省略 - 以前のコードと同じ)
        });
    </script>

</body>
</html>
<<<<<<< HEAD
=======
```

>>>>>>> ddb4b7b7eafd9da8db9f8206bcdeba3747b626b2
