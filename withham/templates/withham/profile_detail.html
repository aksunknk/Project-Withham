{# withham/templates/withham/profile_detail.html #}

{% extends "withham/base.html" %} {# ベーステンプレートを継承 #}
{% load static %} {# デフォルト画像表示のために static をロード #}

{% block title %}{{ profile_user.username }}のプロフィール - withham{% endblock %} {# ページのタイトル #}

{% block content %} {# contentブロックを上書き #}

    {# --- プロフィールヘッダー情報 --- #}
    <div class="profile-header mb-4 p-4 bg-light rounded border"> {# パディング、背景色、角丸、枠線を追加 #}
        <div class="d-flex align-items-center">
            {# (将来的に) プロフィール画像 #}
            {# <img src="..." class="rounded-circle me-3" width="80" height="80" alt="プロフィール画像"> #}
            <div class="flex-grow-1">
                <h2 class="mb-1">{{ profile_user.username }}</h2>
                {# (将来的に) 自己紹介文など #}
                {# <p class="text-muted mb-2">ここに自己紹介文が入ります。</p> #}

                {# ★ 自分のプロフィールか他人かでボタンを出し分ける #}
                {% if request.user == profile_user %}
                    {# 自分のプロフィールの場合 #}
                    <a href="#" class="btn btn-outline-secondary btn-sm mt-2">プロフィールを編集</a>
                    {# ↑ 編集機能のURLは別途作成 #}
                {% else %}
                    {# 他人のプロフィールの場合（フォロー機能実装後） #}
                    {# <button class="btn btn-primary btn-sm mt-2">フォローする</button> #}
                    {# <button class="btn btn-secondary btn-sm mt-2">アンフォロー</button> #}
                {% endif %}
            </div>
        </div>
        {# (将来的に) フォロー・フォロワー数など #}
        {# <div class="mt-3">
            <span class="me-3"><strong>100</strong> フォロー中</span>
            <span><strong>250</strong> フォロワー</span>
        </div> #}
    </div>

    {# --- ハムスター一覧表示エリア --- #}
    <div class="hamster-section mb-4">
        <h3><i class="bi bi-heart-fill text-danger"></i> このユーザーのハムスター</h3> {# アイコン例 (Bootstrap Iconsが必要) #}
        {# BootstrapのGridを使ってカードを並べる #}
        <div class="row row-cols-2 row-cols-sm-3 row-cols-md-4 g-3 mt-2"> {# 画面幅に応じて列数を変更 #}
            {% for hamster in hamsters %} {# ★ ビューから渡された 'hamsters' をループ #}
                <div class="col">
                    <div class="card text-center h-100 shadow-sm"> {# カードに影を追加 #}
                        {% if hamster.profile_image %}
                            {# ハムスターの画像があれば表示 #}
                            <img src="{{ hamster.profile_image.url }}" class="card-img-top" alt="{{ hamster.name }}" style="aspect-ratio: 1 / 1; object-fit: cover;">
                        {% else %}
                            {# なければデフォルト画像を表示 (staticディレクトリに画像が必要) #}
                            <img src="{% static 'images/default_hamster_icon.svg' %}" class="card-img-top p-3" alt="デフォルト画像" style="aspect-ratio: 1 / 1; object-fit: contain; background-color: #eee;">
                            {# ↑ default_hamster_icon.svg は用意した画像ファイル名・パスに変更してください #}
                        {% endif %}
                        <div class="card-body p-2">
                            {# ハムスターの名前 (詳細ページへのリンクは今は#) #}
                            <h6 class="card-title mb-0"><a href="#" class="text-decoration-none stretched-link">{{ hamster.name }}</a></h6>
                        </div>
                    </div>
                </div>
            {% empty %}
                {# ハムスターが1匹も登録されていない場合に表示 #}
                <div class="col-12">
                    <p class="text-muted">まだハムスターが登録されていません。</p>
                    {# 自分のプロフィールの場合のみ登録を促すリンクを表示 #}
                    {% if request.user == profile_user %}
                         <a href="{% url 'withham:hamster_create' %}" class="btn btn-sm btn-outline-success">ハムスターを登録する</a>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
        <hr class="mt-4"> {# 区切り線 #}
    </div>

    {# --- 投稿一覧表示エリア --- #}
    <h3 class="mb-3"><i class="bi bi-pencil-square"></i> 投稿一覧</h3> {# アイコン例 #}

    {# ★ 投稿一覧表示部分は index.html と同様のカード形式 #}
    {% for post in posts %} {# ビューから渡された 'posts' リストをループ #}
        <div class="card mb-3 shadow-sm">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <div class="lh-sm">
                        <h5 class="card-title mb-0">
                            {# プロフィールページなので投稿者名は省略しても良いかも #}
                            {% if post.hamster %}
                                 <span class="badge bg-info fw-normal">🐹 {{ post.hamster.name }}</span>
                            {% endif %}
                        </h5>
                    </div>
                    <small class="text-muted flex-shrink-0 ms-2">{{ post.created_at|date:"y/m/d H:i" }}</small>
                </div>
                <p class="card-text mt-2 mb-2">{{ post.text|linebreaksbr }}</p>
                {% if post.image %}
                    <img src="{{ post.image.url }}" class="img-fluid rounded mb-2" alt="投稿画像 {{ post.id }}">
                {% endif %}
                <div class="d-flex justify-content-start">
                    <button type="button" class="btn btn-outline-secondary btn-sm me-2"><i class="bi bi-chat"></i> コメント</button>
                    <button type="button" class="btn btn-outline-danger btn-sm me-2"><i class="bi bi-heart"></i> いいね</button>
                </div>
            </div>
        </div>
    {% empty %}
        <div class="alert alert-secondary mt-4" role="alert">
            まだ投稿がありません。
        </div>
    {% endfor %}

{% endblock %} {# contentブロックの終了 #}